# MOJ Real Estate AI Extractor

An AI-powered API that extracts real estate deal data from the Saudi Ministry of Justice PowerBI report. It accepts natural language queries (e.g., "deals in Riyadh last week") and returns structured data.

## Features
- **Natural Language Processing**: Uses OpenAI to interpret fuzzy date ranges and filters.
- **Headless Browser Automation**: Uses Playwright to interact with the PowerBI report.
- **API First**: FastAPI backend ready for integration.
- **Dockerized**: Ready for Railway/cloud deployment.

## Prerequisites
- Python 3.10+
- OpenAI API Key

## Local Setup

1. **Install Dependencies**
   ```bash
   pip install -r requirements.txt
   playwright install chromium
   ```

2. **Set Environment Variables**
   Create a `.env` file or export the variable:
   ```bash
   export OPENAI_API_KEY="your-sk-..."
   ```

3. **Run the API**
   ```bash
   uvicorn main:app --reload
   ```

4. **Test the Endpoint**
   ```bash
   curl -X POST "http://localhost:8000/extract" \
        -H "Content-Type: application/json" \
        -d '{"query": "Get me deal details for the past 3 days in Riyadh"}'
   ```

## Deploying to Railway

1. **Push code to GitHub**.
2. **Create a new Service** in Railway from your repository.
3. **Add Environment Variable**:
   - `OPENAI_API_KEY`: Set your live OpenAI key.
4. **Deploy**: Railway will automatically build using the [Dockerfile](file:///Users/seifelshamy/.gemini/antigravity/brain/b7306dbd-5ee1-4036-9614-9746787b32ee/ai-moj-extractor/Dockerfile).

## How it Works
1. User sends natural language query to `/extract`.
2. [query_engine.py](file:///Users/seifelshamy/.gemini/antigravity/brain/b7306dbd-5ee1-4036-9614-9746787b32ee/ai-moj-extractor/query_engine.py) uses LLM to convert "past 3 days" to `start_date` and `end_date`.
3. [scraper.py](file:///Users/seifelshamy/.gemini/antigravity/brain/b7306dbd-5ee1-4036-9614-9746787b32ee/ai-moj-extractor/scraper.py) launches a headless browser, navigates to the MOJ report, applies the date filters via coordinate interaction (as fallback to selectors), and scrapes the data table.
4. Returns JSON data.
